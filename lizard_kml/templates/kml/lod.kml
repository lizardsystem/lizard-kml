{% spaceless %}
<?xml version="1.0" encoding="UTF-8"?>
{% load tools %}
<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:gx="http://www.google.com/kml/ext/2.2" xmlns:kml="http://www.opengis.net/kml/2.2" xmlns:atom="http://www.w3.org/2005/Atom">
  <Document>
    <name>Transect Overview</name>
    <open>1</open>
    <Style id="thin">
      <LineStyle>
	<color>33ffffff</color>
      </LineStyle>
    </Style>
    <Style id="thick">
      <IconStyle>
	<scale>5</scale>
      </IconStyle>
      <LineStyle>
	<color>88ffffff</color>
      </LineStyle>
    </Style>
    <StyleMap id="whiteline">
      <Pair>
	<key>normal</key>
	<styleUrl>#thin</styleUrl>
      </Pair>
      <Pair>
	<key>highlight</key>
	<styleUrl>#thick</styleUrl>
      </Pair>
    </StyleMap>
    <Folder>
      {% for line in lines %}
      <NetworkLink>
	<name>Transect {{ line.id }} </name>
	<Region>
	  <LatLonAltBox>
	    <north>{{ line.bbox.north }} </north>
	    <south>{{ line.bbox.south }} </south>
	    <east>{{ line.bbox.east }}</east>
	    <west>{{ line.bbox.west }}</west>
	    <minAltitude>-20</minAltitude>
	    <!-- Make 50 meters high, so you get more transects if you fly over them -->
	    <maxAltitude>50</maxAltitude>
	    <altitudeMode>absolute</altitudeMode>
	  </LatLonAltBox>
	  <Lod>
	    <!-- Don't show too many lines -->
	    <!-- alternate lod, so we get different transects at different levels -->
	    <minLodPixels>{% cycle 512 256 512 128 512 256 512 64 %}</minLodPixels>
	  </Lod>
	</Region>
	<Link>
	  {% comment %}
	  Replace these query parameters in the url tag... (or extend url to match these parameters)
	  Don't forget to escape &
	  {% endcomment %}.	
	  <href>{% absurl lizard-kml-kml kml_type='transect' id=line.id %}?exaggeration={{ exaggeration }}&amp;lift={{ lift }}</href>
	  <viewRefreshMode>onRegion</viewRefreshMode>
	</Link>
      </NetworkLink>
      <Placemark>
	<name>Transect {{ line.id }} </name>
	<styleUrl>#whiteline</styleUrl>
	<LineString>
	  <coordinates>
	    {{ line.coordinates }}
	  </coordinates>
	</LineString>
	<description><![CDATA[
	some text....
	<!--  -->
	<iframe src="{% url lizard-kml-info id=line.id %}" width="300"/>
	]]>
	</description>
      </Placemark>
      {% endfor %}
    </Folder>
  </Document>
</kml>
{% endspaceless %}